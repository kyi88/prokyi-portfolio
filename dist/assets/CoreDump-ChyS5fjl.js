import{a as d,j as o,A as p,m}from"./framer-motion-DjJR-6Ks.js";const u={"0x0539":"ぷろきぃの好きな数字は539","0xDEAD":"ゲップができない体質","0xCAFE":"コーヒー飲めない（カフェイン不耐性）","0xBEEF":"牛乳も飲めない（乳糖不耐性）"};function x(c){const a=[];for(const t of c){const s=t.charCodeAt(0);s<=255?a.push(s):a.push(s>>8&255,s&255)}const i=[];for(let t=0;t<a.length;t+=12){const s=a.slice(t,t+12),l=`0x${t.toString(16).toUpperCase().padStart(4,"0")}`,e=s.map(n=>n.toString(16).toUpperCase().padStart(2,"0")).join(" "),r=s.map(n=>n>=32&&n<=126?String.fromCharCode(n):".").join("");i.push({addr:l,hex:e,ascii:r})}return i}function h(){if(!document.body)return"";const c=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:i=>{const t=i.parentElement;return!t||t.closest(".coredump-overlay")||t.closest("script")||t.closest("style")?NodeFilter.FILTER_REJECT:i.textContent.trim()?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});let a="";for(;c.nextNode()&&(a+=c.currentNode.textContent.trim()+" ",!(a.length>2e3)););return a}function y(c){const a=Object.keys(u),i=[...c];return a.forEach(t=>{const s=u[t],l=Array.from(s).map((e,r)=>((r*7+65)%255).toString(16).toUpperCase().padStart(2,"0")).join(" ").slice(0,35);i.push({addr:t,hex:l,ascii:s.slice(0,12),isSecret:!0,fullMsg:s})}),i.sort((t,s)=>parseInt(t.addr,16)-parseInt(s.addr,16)),i}function v(){const[c,a]=d.useState(!1),[i,t]=d.useState(new Set);d.useEffect(()=>{const e=r=>{r.ctrlKey&&r.shiftKey&&(r.key==="d"||r.key==="D")&&(r.preventDefault(),a(n=>!n)),r.key==="Escape"&&c&&(r.preventDefault(),a(!1))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c]),d.useEffect(()=>{const e=()=>a(r=>!r);return window.addEventListener("prokyi-coredump-toggle",e),()=>window.removeEventListener("prokyi-coredump-toggle",e)},[]);const s=d.useMemo(()=>{if(!c)return[];const e=h(),r=x(e);return y(r)},[c]),l=d.useCallback(e=>{t(r=>{const n=new Set(r);return n.add(e),n})},[]);return o.jsx(p,{children:c&&o.jsxs(m.div,{className:"coredump-overlay",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},role:"dialog","aria-modal":"true","aria-label":"Core Dump Hex Viewer",children:[o.jsx("div",{className:"coredump-overlay__scanline"}),o.jsxs("div",{className:"coredump-overlay__header",children:[o.jsxs("span",{children:["*** CORE DUMP — MEMORY SNAPSHOT @ ",new Date().toLocaleTimeString("ja-JP")," ***"]}),o.jsx("button",{className:"coredump-overlay__close",onClick:()=>a(!1),children:"[ESC] CLOSE"})]}),o.jsxs("div",{className:"coredump-overlay__row",style:{color:"#555",marginBottom:8},children:[o.jsx("span",{className:"coredump-overlay__addr",children:"OFFSET"}),o.jsx("span",{className:"coredump-overlay__hex",children:"HEX DUMP"}),o.jsx("span",{className:"coredump-overlay__ascii",children:"ASCII"})]}),s.map((e,r)=>o.jsxs("div",{className:`coredump-overlay__row${e.isSecret?" coredump-overlay__row--secret":""}`,onClick:e.isSecret?()=>l(e.addr):void 0,onKeyDown:e.isSecret?n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),l(e.addr))}:void 0,role:e.isSecret?"button":void 0,tabIndex:e.isSecret?0:void 0,"aria-label":e.isSecret?`Secret address ${e.addr}`:void 0,children:[o.jsx("span",{className:"coredump-overlay__addr",children:e.addr}),o.jsx("span",{className:"coredump-overlay__hex",children:e.hex}),o.jsx("span",{className:"coredump-overlay__ascii",children:e.isSecret&&i.has(e.addr)?e.fullMsg:e.ascii})]},r)),o.jsxs("div",{style:{color:"#555",marginTop:16},children:["--- END OF DUMP --- ",s.length," rows, ",s.length*12," bytes analyzed"]})]})})}const S=d.memo(v);export{S as default};
