import{a,j as n,m as S}from"./framer-motion-DjJR-6Ks.js";const v={click:"TCP/CLICK",wheel:"UDP/SCROLL",mousemove:"ICMP/HOVER",keydown:"SSH/KEY"},P=80;function x(r){return Array.from({length:r},()=>Math.floor(Math.random()*256).toString(16).toUpperCase().padStart(2,"0")).join("")}function $(){const[r,d]=a.useState(!1),[c,g]=a.useState(!1),[l,k]=a.useState([]),[_,E]=a.useState(null),u=a.useRef(null),j=a.useRef(!1);j.current=c,a.useEffect(()=>{const t=e=>{if(e.key==="Escape"&&r){d(!1);return}e.ctrlKey&&e.shiftKey&&(e.key==="p"||e.key==="P")&&e.altKey&&(e.preventDefault(),d(s=>!s))},i=()=>d(e=>!e);return window.addEventListener("keydown",t),window.addEventListener("prokyi-sniff-toggle",i),()=>{window.removeEventListener("keydown",t),window.removeEventListener("prokyi-sniff-toggle",i)}},[r]),a.useEffect(()=>{if(!r)return;const t=e=>s=>{var b,y,N;if(j.current)return;const m=v[e],p=new Date().toLocaleTimeString("ja-JP",{hour12:!1});let o="";if(e==="click")o=`Target: <${(((b=s.target)==null?void 0:b.tagName)||"?").toLowerCase()}> pos(${s.clientX},${s.clientY})`;else if(e==="wheel")o=`scrollY=${Math.round(window.scrollY)} delta=${s.deltaY||0}`;else if(e==="mousemove")o=`pos(${s.clientX},${s.clientY}) CRC:${x(2)}`;else if(e==="keydown"){const f=((y=s.target)==null?void 0:y.tagName)||"";if(f==="INPUT"||f==="TEXTAREA"||(N=s.target)!=null&&N.isContentEditable)return;o=`key=[${s.code}] mod=${s.ctrlKey?"C":""}${s.shiftKey?"S":""}${s.altKey?"A":""}`}const h={id:Date.now()+Math.random(),time:p,proto:m,src:`USR:0x${x(2)}`,dst:`DOM:0x${x(2)}`,payload:o};k(f=>{const w=[...f,h];return w.length>P?w.slice(-P):w})},i=Object.keys(v).map(e=>{const s=t(e);if(e==="mousemove"){let m=0;const p=o=>{const h=Date.now();h-m>300&&(m=h,s(o))};return window.addEventListener(e,p,{passive:!0}),[e,p]}return window.addEventListener(e,s,{passive:!0}),[e,s]});return()=>i.forEach(([e,s])=>window.removeEventListener(e,s))},[r]),a.useEffect(()=>{u.current&&!c&&(u.current.scrollTop=u.current.scrollHeight)},[l,c]),a.useEffect(()=>{r||(k([]),g(!1),E(null))},[r]);const C=_?l.filter(t=>t.proto===_):l;return r?n.jsxs(S.div,{className:"packet-sniffer",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.15},role:"dialog","aria-label":"Packet Sniffer","aria-modal":"true",children:[n.jsxs("div",{className:"packet-sniffer__header",children:[n.jsx("span",{children:"ðŸ¦ˆ PACKET SNIFFER â€” eth0 promisc"}),n.jsxs("div",{className:"packet-sniffer__controls",children:[n.jsx("button",{className:"packet-sniffer__btn",onClick:()=>g(t=>!t),"aria-label":c?"Resume":"Pause",children:c?"â–¶":"â¸"}),n.jsx("button",{className:"packet-sniffer__btn",onClick:()=>k([]),"aria-label":"Clear",children:"CLR"}),n.jsx("button",{className:"packet-sniffer__btn",onClick:()=>d(!1),"aria-label":"Close",children:"âœ•"})]})]}),n.jsxs("div",{className:"packet-sniffer__stats",children:[n.jsxs("span",{children:["PKT: ",l.length]}),Object.values(v).map(t=>n.jsx("button",{className:`packet-sniffer__btn${_===t?" packet-sniffer__btn--active":""}`,onClick:()=>E(i=>i===t?null:t),children:t.split("/")[1]},t))]}),n.jsxs("div",{className:"packet-sniffer__body",ref:u,children:[C.map(t=>n.jsxs("div",{className:"packet-sniffer__row",children:[n.jsx("span",{className:"packet-sniffer__col packet-sniffer__col--time",children:t.time}),n.jsx("span",{className:"packet-sniffer__col packet-sniffer__col--proto","data-proto":t.proto,children:t.proto}),n.jsxs("span",{className:"packet-sniffer__col packet-sniffer__col--payload",children:[t.src," â†’ ",t.dst," | ",t.payload]})]},t.id)),C.length===0&&n.jsx("div",{style:{color:"#555",padding:"12px",textAlign:"center"},children:l.length===0?"Waiting for packets...":"No packets match filter."})]})]}):null}const L=a.memo($);export{L as default};
